<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; font-src 'self' data: https://fonts.gstatic.com https://sickn33.github.io; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; script-src 'self' 'unsafe-inline' https://apis.google.com https://accounts.google.com; img-src 'self' data: blob: https://*.sharepoint.com https://*.microsoft.com https://*.microsoftonline.com https://*.live.com https://*.1drv.com https://*.onedrive.com https://*.office.com https://*.office365.com https: https://*.googleusercontent.com https://lh3.googleusercontent.com; media-src 'self' blob: https://*.workers.dev https://*.sharepoint.com https://*.microsoft.com https://*.microsoftonline.com https://*.live.com https://*.1drv.com https://*.onedrive.com; connect-src 'self' https://*.workers.dev https://www.googleapis.com https://accounts.google.com https://photospicker.googleapis.com; frame-src https://docs.google.com https://picker.google.com https://accounts.google.com https://photos.google.com;"
    />
    <title>Carica i tuoi momenti</title>
    <meta
      name="description"
      content="Carica foto e video sul nostro drive condiviso in modo semplice e veloce"
    />

    <!-- Google Fonts: Cormorant Garamond (headings) + DM Sans (body) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,700&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,700&display=swap"
      rel="stylesheet"
    />

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23C77825' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'><circle cx='12' cy='12' r='10'/><circle cx='12' cy='12' r='3'/></svg>"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/utilities.css" />
  </head>
  <body>
    <!-- Noise Overlay -->
    <div class="noise-overlay"></div>
    <!-- Password Gate -->
    <div class="password-gate" id="passwordGate">
      <div class="glass-card password-card">
        <span class="icon icon-xl">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect width="18" height="11" x="3" y="11" rx="2" ry="2" />
            <path d="M7 11V7a5 5 0 0 1 10 0v4" />
          </svg>
        </span>
        <h2>Area Riservata</h2>
        <p>Inserisci la password per accedere</p>
        <input
          type="password"
          id="passwordInput"
          class="password-input"
          placeholder="Password..."
          autocomplete="off"
        />
        <button
          class="btn btn-primary"
          id="passwordSubmit"
          onclick="checkPassword()"
        >
          <span class="icon icon-sm">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M5 12h14" />
              <path d="m12 5 7 7-7 7" />
            </svg>
          </span>
          Entra
        </button>
        <p class="password-error hidden" id="passwordError">
          <span class="icon icon-sm icon-error">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10" />
              <path d="m15 9-6 6" />
              <path d="m9 9 6 6" />
            </svg>
          </span>
          Password errata
        </p>
      </div>
    </div>

    <div class="app-container hidden" id="appContainer">
      <!-- Header -->
      <header class="header">
        <div class="logo">
          <span class="icon icon-lg logo-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"
              />
              <circle cx="12" cy="13" r="3" />
            </svg>
          </span>
          <h1>I Nostri Momenti</h1>
        </div>
      </header>

      <!-- Navigation Tabs -->
      <nav class="nav-tabs">
        <button
          class="nav-tab active"
          id="tabUpload"
          onclick="showSection('upload')"
        >
          <span class="icon icon-sm tab-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="17 8 12 3 7 8" />
              <line x1="12" x2="12" y1="3" y2="15" />
            </svg>
          </span>
          Carica
        </button>
        <button
          class="nav-tab"
          id="tabGallery"
          onclick="showSection('gallery')"
        >
          <span class="icon icon-sm tab-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <rect width="18" height="18" x="3" y="3" rx="2" ry="2" />
              <circle cx="9" cy="9" r="2" />
              <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" />
            </svg>
          </span>
          Galleria
        </button>
      </nav>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Upload Section (shown immediately after password) -->
        <section class="upload-section" id="uploadSection">
          <!-- Drop Zone -->
          <div class="glass-card drop-zone" id="dropZone">
            <div class="drop-zone-content">
              <span class="icon icon-xxl drop-icon">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"
                  />
                </svg>
              </span>
              <h3>Trascina qui i tuoi file</h3>
              <p>oppure</p>
              <div class="upload-buttons">
                <label class="btn btn-primary file-input-label">
                  <span class="icon icon-sm">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path
                        d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48"
                      />
                    </svg>
                  </span>
                  Seleziona file
                  <input
                    type="file"
                    id="fileInput"
                    multiple
                    accept="image/*,video/*"
                    hidden
                  />
                </label>
                <button
                  class="btn btn-secondary google-drive-btn"
                  onclick="event.stopPropagation(); openGoogleDrivePicker()"
                  title="Importa da Google Drive"
                >
                  <span class="icon icon-sm">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path
                        fill="currentColor"
                        d="M7.71 3.5L1.15 15l3.43 5.95 6.56-11.45L7.71 3.5zm8.58 0H7.71l6.56 11.5h8.58L16.29 3.5zM12 12.5L5.44 24h13.12L12 12.5z"
                      />
                    </svg>
                  </span>
                  Drive
                </button>
                <button
                  class="btn btn-secondary google-photos-btn"
                  onclick="event.stopPropagation(); openGooglePhotosPicker()"
                  title="Importa da Google Photos"
                >
                  <span class="icon icon-sm">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path
                        fill="currentColor"
                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"
                      />
                    </svg>
                  </span>
                  Photos
                </button>
              </div>
              <p class="hint">Supporta immagini e video fino a 500MB</p>
            </div>
          </div>

          <!-- File Queue -->
          <div class="glass-card file-queue-card hidden" id="fileQueueCard">
            <div class="queue-header">
              <h3>
                <span class="icon icon-sm">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
                    <path
                      d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
                    />
                    <path d="M12 11h4" />
                    <path d="M12 16h4" />
                    <path d="M8 11h.01" />
                    <path d="M8 16h.01" />
                  </svg>
                </span>
                File in coda
              </h3>
              <button
                class="btn btn-primary"
                id="uploadAllBtn"
                onclick="uploadAll()"
              >
                <span class="icon icon-sm">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <polyline points="17 8 12 3 7 8" />
                    <line x1="12" x2="12" y1="3" y2="15" />
                  </svg>
                </span>
                Carica tutti
              </button>
            </div>
            <div class="file-list" id="fileList"></div>
          </div>

          <!-- Upload Progress -->
          <div class="glass-card progress-card hidden" id="progressCard">
            <h3>
              <span class="icon icon-sm spinning">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M21 12a9 9 0 1 1-6.219-8.56" />
                </svg>
              </span>
              Caricamento in corso...
            </h3>
            <div class="progress-bar-container">
              <div class="progress-bar" id="progressBar"></div>
            </div>
            <p class="progress-text" id="progressText">0%</p>
          </div>

          <!-- Completed Uploads -->
          <div class="glass-card completed-card hidden" id="completedCard">
            <h3>
              <span class="icon icon-sm icon-success">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                  <polyline points="22 4 12 14.01 9 11.01" />
                </svg>
              </span>
              Caricamenti completati
            </h3>
            <div class="completed-list" id="completedList"></div>
          </div>
        </section>

        <!-- Gallery Section -->
        <section class="gallery-section hidden" id="gallerySection">
          <!-- Loading State -->
          <div class="gallery-loading" id="galleryLoading">
            <div class="loading-spinner"></div>
            <p>Caricamento galleria...</p>
          </div>

          <!-- Empty State -->
          <div class="gallery-empty hidden" id="galleryEmpty">
            <span class="icon icon-xxl empty-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect width="20" height="16" x="2" y="4" rx="2" />
                <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7" />
              </svg>
            </span>
            <h3>Nessuna immagine</h3>
            <p>Carica qualche foto per vederla qui!</p>
          </div>

          <!-- Gallery Grid -->
          <div class="gallery-grid hidden" id="galleryGrid"></div>
        </section>
      </main>

      <!-- Footer -->
      <footer class="footer">
        <p>
          Creato con
          <span class="icon icon-sm heart-icon"
            ><svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"
              /></svg
          ></span>
          per condividere i nostri momenti
        </p>
      </footer>
    </div>

    <!-- Lightbox Overlay -->
    <div class="lightbox hidden" id="lightbox">
      <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
      <button class="lightbox-nav lightbox-prev" onclick="navigateLightbox(-1)">
        ❮
      </button>
      <div class="lightbox-content">
        <img id="lightboxImage" src="" alt="" />
        <video
          id="lightboxVideo"
          controls
          playsinline
          crossorigin="anonymous"
          class="hidden"
        ></video>
      </div>
      <button class="lightbox-nav lightbox-next" onclick="navigateLightbox(1)">
        ❯
      </button>
      <div class="lightbox-info">
        <span id="lightboxTitle"></span>
        <span id="lightboxCounter"></span>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts (no more MSAL or Graph SDK needed!) -->
    <script src="js/password-gate.js"></script>
    <script src="js/config.js"></script>
    <script src="js/upload.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/gallery.js"></script>
    <script src="js/google-picker.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
